<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonStream Player</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Шрифт -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: #050505;
            color: #e0e0e0;
            /* Отступ снизу для плеера */
            padding-bottom: 160px; 
            -webkit-tap-highlight-color: transparent;
        }

        /* Кастомный скроллбар */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #06b6d4; }

        /* Стили для ползунка (Range Slider) */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 0; 
            width: 0;
        }
        input[type=range]:focus { outline: none; }

        /* Анимация обложки */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 8s linear infinite;
        }

        /* Эффект нажатия на трек */
        .track-item.active {
            background-color: rgba(6, 182, 212, 0.1);
            border-color: rgba(6, 182, 212, 0.5);
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.1);
        }
        .track-item.active h4 { color: #22d3ee; }
        
        /* Визуалайзер */
        .bar {
            width: 4px;
            background-color: #22d3ee;
            animation: bounce 0.5s infinite alternate;
        }
        @keyframes bounce {
            10% { height: 10%; }
            100% { height: 100%; }
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="selection:bg-cyan-500 selection:text-black min-h-screen">

    <!-- Фоновая атмосфера -->
    <div class="fixed inset-0 bg-[radial-gradient(circle_at_50%_0%,_#1a1a1a_0%,_#000000_100%)] -z-10 pointer-events-none"></div>
    <div class="fixed top-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-50"></div>

    <!-- Шапка -->
    <header class="sticky top-0 z-40 bg-black/80 backdrop-blur-md border-b border-white/10 px-6 py-4">
        <div class="max-w-2xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-cyan-500 rounded-full shadow-[0_0_10px_#06b6d4] animate-pulse"></div>
                <h1 class="text-xl font-bold tracking-widest uppercase font-mono">
                    Neon<span class="text-cyan-400">Stream</span>
                </h1>
            </div>
            <!-- Иконка плейлиста (декоративная) -->
            <svg class="w-6 h-6 text-gray-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15V6"/><path d="M18.5 18a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/><path d="M12 12H3"/><path d="M16 6H3"/><path d="M12 18H3"/></svg>
        </div>
    </header>

    <!-- Список песен -->
    <main class="max-w-2xl mx-auto px-4 py-6" id="playlist-container">
        <!-- Треки будут добавлены сюда через JS -->
    </main>
    
    <div class="h-12 text-center mt-8 opacity-20 text-xs font-mono max-w-2xl mx-auto">
        -- END OF PLAYLIST --
    </div>

    <!-- Плеер -->
    <div class="fixed bottom-0 left-0 right-0 bg-black/90 backdrop-blur-lg border-t border-cyan-500/30 p-4 pb-8 z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.8)]">
        
        <!-- Прогресс бар -->
        <div class="absolute top-0 left-0 right-0 h-1 bg-gray-800 cursor-pointer group">
            <div id="progress-fill" class="h-full bg-cyan-500 relative shadow-[0_0_10px_rgba(6,182,212,0.5)] w-0 transition-all duration-100 ease-linear">
                <div class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)] opacity-0 group-hover:opacity-100 transition-opacity"></div>
            </div>
            <input type="range" id="progress-input" min="0" value="0" step="1" class="absolute inset-0 w-full h-4 -top-2 opacity-0 cursor-pointer z-10">
        </div>

        <div class="flex items-center justify-between mt-3 gap-3 max-w-2xl mx-auto">
            
            <!-- Инфо о треке -->
            <div class="flex-1 min-w-0 flex items-center gap-3">
                <div id="cover-art" class="w-12 h-12 rounded-md bg-gray-800 border border-cyan-500/20 overflow-hidden shrink-0">
                    <img src="" alt="cover" class="w-full h-full object-cover hidden">
                </div>
                <div class="flex flex-col min-w-0">
                    <h3 id="track-title" class="text-white font-bold truncate text-sm sm:text-base leading-tight">Loading...</h3>
                    <p id="track-artist" class="text-cyan-400 text-xs truncate opacity-80">...</p>
                </div>
            </div>

            <!-- Кнопки управления -->
            <div class="flex items-center gap-3 sm:gap-5 shrink-0">
                <!-- Назад -->
                <button id="btn-prev" class="text-gray-400 hover:text-white transition-colors active:scale-90 p-2">
                    <svg class="w-6 h-6 sm:w-8 sm:h-8" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M19 20L9 12l10-8v16zM5 19h2V5H5v14z"></path></svg>
                </button>
                
                <!-- Play/Pause -->
                <button id="btn-play" class="w-12 h-12 sm:w-14 sm:h-14 flex items-center justify-center rounded-full bg-cyan-500 text-black hover:bg-cyan-400 hover:scale-105 active:scale-95 transition-all shadow-[0_0_15px_rgba(6,182,212,0.4)]">
                    <!-- Иконка Play -->
                    <svg id="icon-play" class="w-6 h-6 sm:w-7 sm:h-7 ml-1" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"></path></svg>
                    <!-- Иконка Pause (скрыта по умолчанию) -->
                    <svg id="icon-pause" class="w-6 h-6 sm:w-7 sm:h-7 hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                </button>

                <!-- Вперед -->
                <button id="btn-next" class="text-gray-400 hover:text-white transition-colors active:scale-90 p-2">
                    <svg class="w-6 h-6 sm:w-8 sm:h-8" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M5 4l10 8-10 8V4zM19 5h-2v14h2V5z"></path></svg>
                </button>

                <!-- Кнопка ЧАТ -->
                <a href="https://t.me/" target="_blank" class="flex flex-col items-center justify-center text-gray-400 hover:text-cyan-400 transition-colors ml-2 group active:scale-90">
                    <div class="p-2 rounded-full border border-white/10 group-hover:border-cyan-500/50 bg-white/5">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    </div>
                </a>
            </div>
        </div>

        <!-- Таймеры -->
        <div class="flex justify-between text-[10px] text-gray-500 mt-1 font-mono tracking-wider px-1 max-w-2xl mx-auto">
            <span id="time-current">0:00</span>
            <span id="time-total">0:00</span>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ==========================================
        // 1. СПИСОК ПЕСЕН (Массив)
        // Редактируйте этот список вручную!
        // ==========================================
        const tracks = [
            {
                id: '1',
                title: 'Neon Horizon',
                artist: 'CyberSynth',
                url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
                cover: 'https://picsum.photos/id/1/200/200',
                durationStr: '6:12'
            },
            {
                id: '2',
                title: 'Night Runner',
                artist: 'Retro Wave',
                url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
                cover: 'https://picsum.photos/id/2/200/200',
                durationStr: '7:05'
            },
            {
                id: '3',
                title: 'Digital Rain',
                artist: 'Glitch Protocol',
                url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',
                cover: 'https://picsum.photos/id/3/200/200',
                durationStr: '5:44'
            },
             {
                id: '4',
                title: 'System Failure',
                artist: 'Null Pointer',
                url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3',
                cover: 'https://picsum.photos/id/4/200/200',
                durationStr: '3:20'
            }
        ];

        // ==========================================
        // 2. Инициализация переменных
        // ==========================================
        let currentTrackIndex = 0;
        let isPlaying = false;
        const audio = new Audio();
        
        // Элементы DOM
        const playlistContainer = document.getElementById('playlist-container');
        const btnPlay = document.getElementById('btn-play');
        const btnNext = document.getElementById('btn-next');
        const btnPrev = document.getElementById('btn-prev');
        const iconPlay = document.getElementById('icon-play');
        const iconPause = document.getElementById('icon-pause');
        
        const trackTitle = document.getElementById('track-title');
        const trackArtist = document.getElementById('track-artist');
        const coverArtContainer = document.getElementById('cover-art');
        const coverImg = coverArtContainer.querySelector('img');
        
        const progressInput = document.getElementById('progress-input');
        const progressFill = document.getElementById('progress-fill');
        const timeCurrent = document.getElementById('time-current');
        const timeTotal = document.getElementById('time-total');

        // ==========================================
        // 3. Основные функции
        // ==========================================

        // Рендеринг списка песен
        function renderPlaylist() {
            playlistContainer.innerHTML = '';
            tracks.forEach((track, index) => {
                const isActive = index === currentTrackIndex;
                const div = document.createElement('div');
                div.className = `track-item group relative flex items-center gap-4 p-4 mb-2 rounded-xl cursor-pointer transition-all duration-300 border bg-zinc-900/50 border-white/5 hover:border-white/20 hover:bg-zinc-800 ${isActive ? 'active' : ''}`;
                div.onclick = () => playTrack(index);

                // Номер трека или анимация проигрывания
                let iconHtml = `<span class="group-hover:hidden text-gray-500 font-mono text-xs">${String(index + 1).padStart(2, '0')}</span>`;
                if (isActive && isPlaying) {
                    iconHtml = `
                    <div class="flex items-end gap-[2px] h-3 w-4">
                        <div class="bar" style="animation-delay: 0s"></div>
                        <div class="bar" style="animation-delay: 0.1s"></div>
                        <div class="bar" style="animation-delay: 0.2s"></div>
                    </div>`;
                } else {
                    iconHtml += `<svg class="w-4 h-4 text-cyan-400 hidden group-hover:block absolute left-5" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"></path></svg>`;
                }

                div.innerHTML = `
                    <div class="w-6 flex justify-center">${iconHtml}</div>
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold truncate text-lg text-gray-200">${track.title}</h4>
                        <p class="text-sm text-gray-500 truncate font-mono">${track.artist}</p>
                    </div>
                    <div class="text-xs text-gray-600 font-mono">${track.durationStr}</div>
                `;
                playlistContainer.appendChild(div);
            });
        }

        // Загрузка трека
        function loadTrack(index) {
            const track = tracks[index];
            audio.src = track.url;
            audio.load();
            
            // Обновляем UI плеера
            trackTitle.textContent = track.title;
            trackArtist.textContent = track.artist;
            if (track.cover) {
                coverImg.src = track.cover;
                coverImg.classList.remove('hidden');
            } else {
                coverImg.classList.add('hidden');
            }
            
            updatePlayPauseUI();
            renderPlaylist(); // Чтобы обновить подсветку активного трека
        }

        // Переключение Play/Pause
        function togglePlay() {
            if (isPlaying) {
                audio.pause();
            } else {
                audio.play().catch(err => console.error("Ошибка воспроизведения:", err));
            }
            isPlaying = !isPlaying;
            updatePlayPauseUI();
            renderPlaylist(); // Обновить анимацию эквалайзера в списке
        }

        // Запуск конкретного трека
        function playTrack(index) {
            if (index === currentTrackIndex) {
                togglePlay();
            } else {
                currentTrackIndex = index;
                loadTrack(currentTrackIndex);
                isPlaying = true;
                audio.play();
                updatePlayPauseUI();
                renderPlaylist();
            }
        }

        // Обновление иконок и анимации обложки
        function updatePlayPauseUI() {
            if (isPlaying) {
                iconPlay.classList.add('hidden');
                iconPause.classList.remove('hidden');
                coverImg.classList.add('animate-spin-slow');
                coverImg.style.animationPlayState = 'running';
            } else {
                iconPlay.classList.remove('hidden');
                iconPause.classList.add('hidden');
                coverImg.style.animationPlayState = 'paused';
            }
        }

        // Форматирование времени (секунды -> мм:сс)
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        // Обновление прогресс-бара
        function updateProgress() {
            const { currentTime, duration } = audio;
            const percent = (currentTime / duration) * 100 || 0;
            
            progressFill.style.width = `${percent}%`;
            progressInput.value = currentTime || 0;
            progressInput.max = duration || 100;
            
            timeCurrent.textContent = formatTime(currentTime);
            timeTotal.textContent = formatTime(duration);
        }

        function nextTrack() {
            currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
            playTrack(currentTrackIndex);
        }

        function prevTrack() {
            currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
            playTrack(currentTrackIndex);
        }

        // ==========================================
        // 4. Слушатели событий (Event Listeners)
        // ==========================================
        
        // Кнопки
        btnPlay.addEventListener('click', togglePlay);
        btnNext.addEventListener('click', nextTrack);
        btnPrev.addEventListener('click', prevTrack);

        // Аудио события
        audio.addEventListener('timeupdate', updateProgress);
        audio.addEventListener('ended', nextTrack);
        audio.addEventListener('loadedmetadata', () => {
            timeTotal.textContent = formatTime(audio.duration);
            progressInput.max = audio.duration;
        });

        // Перемотка (Seek)
        progressInput.addEventListener('input', (e) => {
            const time = Number(e.target.value);
            audio.currentTime = time;
            updateProgress(); // Мгновенное обновление UI для плавности
        });

        // ==========================================
        // 5. Старт
        // ==========================================
        // Загружаем первый трек при старте (но не играем, пока пользователь не нажмет play)
        loadTrack(currentTrackIndex);
        updatePlayPauseUI(); // Сброс в паузу

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>