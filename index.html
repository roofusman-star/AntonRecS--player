<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AntonRecS--player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <style>
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        /* Стили для кастомного скроллбара */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a202c; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #718096; }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen font-sans">

    <!-- ======================= -->
    <!-- ШАПКА                   -->
    <!-- ======================= -->
    <header class="flex-shrink-0 bg-gray-800 shadow-lg p-4 flex items-center justify-between">
        <h1 class="text-xl font-bold tracking-wider">ANTONRECS--PLAYER</h1>
        
        <!-- ============================================= -->
        <!-- КНОПКА "ВОПРОС-ОТВЕТ"                       -->
        <!-- ============================================= -->
        <button id="openModalBtn" class="p-2 rounded-full hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-colors duration-300" title="Вопрос-Ответ с Антоном">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
        </button>
    </header>

    <!-- ======================= -->
    <!-- ОСНОВНОЙ КОНТЕЙНЕР      -->
    <!-- ======================= -->
    <main class="flex-grow flex flex-col md:flex-row overflow-hidden">
        <!-- Плейлист -->
        <div id="playlist" class="w-full md:w-1/3 bg-gray-800 overflow-y-auto p-4 space-y-2">
            <!-- Треки будут вставлены сюда -->
        </div>

        <!-- Плеер -->
        <div class="w-full md:w-2/3 bg-gray-900 flex flex-col items-center justify-center p-8">
            <img id="album-cover" src="" alt="Album Cover" class="w-64 h-64 rounded-lg shadow-2xl mb-6">
            <h2 id="track-title" class="text-3xl font-bold">---</h2>
            <p id="track-artist" class="text-lg text-gray-400 mb-6">---</p>
            
            <audio id="audio-player" class="hidden"></audio>
            
            <div class="w-full max-w-md">
                <div class="flex justify-between text-xs text-gray-500 mb-1">
                    <span id="time-current">0:00</span>
                    <span id="time-total">0:00</span>
                </div>
                <div class="bg-gray-700 rounded-full h-2 w-full mb-6 cursor-pointer" id="progress-bar-container">
                    <div id="progress-bar" class="bg-cyan-500 h-2 rounded-full" style="width: 0%;"></div>
                </div>
            </div>

            <div class="flex items-center space-x-6">
                <button id="prev-btn" class="p-2 rounded-full hover:bg-gray-800"><svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M8.445 14.832A1 1 0 0010 14.832V5.168a1 1 0 00-1.555-.832L4 8.168v3.664l4.445 3zM12.555 14a1 1 0 01-1-1V7a1 1 0 011-1h.001a1 1 0 011 1v6a1 1 0 01-1 1h-.001z"></path></svg></button>
                <button id="play-pause-btn" class="p-4 bg-cyan-500 rounded-full text-black shadow-lg transform hover:scale-105"><svg id="play-icon" class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path d="M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832L10 11.832V8.168L4.555 5.168z"></path></svg><svg id="pause-icon" class="w-10 h-10 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M5 6a1 1 0 00-1 1v6a1 1 0 002 0V7a1 1 0 00-1-1zm9-1a1 1 0 00-1 1v6a1 1 0 102 0V7a1 1 0 00-1-1z"></path></svg></button>
                <button id="next-btn" class="p-2 rounded-full hover:bg-gray-800"><svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M11.555 5.168A1 1 0 0010 5.168v9.664a1 1 0 001.555.832L16 11.832V8.168l-4.445-3zM7.445 6A1 1 0 018 7v6a1 1 0 01-2 0V7a1 1 0 011.445-1z"></path></svg></button>
            </div>
        </div>
    </main>

    <!-- ============================================= -->
    <!-- МОДАЛЬНОЕ ОКНО "ВОПРОС-ОТВЕТ"               -->
    <!-- ============================================= -->
    <div id="qaModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-900 border border-cyan-500/20 rounded-lg shadow-xl text-white max-w-2xl w-full p-6 relative animate-fade-in">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h2 class="text-2xl font-bold text-cyan-400 mb-4">Антон в Ответе</h2>
            <div class="mb-4">
                <p class="text-gray-400 text-sm mb-1">Вопрос от подписчика:</p>
                <p id="modal-q" class="text-lg italic">"Антон, в чём твоя правда? Зачем ты постоянно говоришь про трещины?"</p>
            </div>
            <div class="border-t border-gray-700 pt-4">
                <p class="text-gray-400 text-sm mb-1">Ответ:</p>
                <p id="modal-a" class="text-lg">"Правда — не в гладкой стене. Гладкая стена врёт. Она скрывает напряжение, усадку, гниль внутри. Правда — в трещине. Она честно показывает, где болит. Моя работа — читать эти трещины. В камне, в коде, в людях. Это и есть моя правда. Смотреть не на то, что красиво, а на то, что честно."</p>
            </div>
            <div class="mt-6 text-center">
                <a href="mailto:roofusman@gmail.com" class="inline-block bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105">
                    Задать свой вопрос
                </a>
            </div>
        </div>
    </div>

    <script>
        // =======================
        // ОСНОВНОЙ СКРИПТ ПЛЕЕРА
        // =======================
        const defaultTracks = [
            {id: "fallback-1", title: "Ошибка загрузки плейлиста", artist: "Система", url: "", cover: "placeholder.png", durationStr: "0:00"}
        ];

        let tracks = [];
        let currentTrackIndex = 0;

        const audioPlayer = document.getElementById('audio-player');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');
        const timeCurrent = document.getElementById('time-current');
        const timeTotal = document.getElementById('time-total');
        const albumCover = document.getElementById('album-cover');
        const trackTitle = document.getElementById('track-title');
        const trackArtist = document.getElementById('track-artist');
        const playlistContainer = document.getElementById('playlist');

        async function fetchTracks() {
            try {
                const response = await fetch('tracks.json?v=' + new Date().getTime());
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                tracks = data.sort((a, b) => b.id - a.id);
            } catch (error) {
                console.error('Failed to fetch tracks.json:', error);
                tracks = defaultTracks;
            }
            buildPlaylist();
            loadTrack(0);
        }

        function buildPlaylist() {
            playlistContainer.innerHTML = '';
            tracks.forEach((track, index) => {
                const trackElement = document.createElement('div');
                trackElement.className = 'p-3 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors flex items-center space-x-4';
                trackElement.dataset.index = index;
                trackElement.innerHTML = `
                    <img src="${track.cover}" alt="${track.title}" class="w-12 h-12 rounded-md object-cover">
                    <div>
                        <p class="font-semibold">${track.title}</p>
                        <p class="text-sm text-gray-400">${track.artist}</p>
                    </div>
                `;
                trackElement.addEventListener('click', () => {
                    loadTrack(index);
                    playTrack();
                });
                playlistContainer.appendChild(trackElement);
            });
        }

        function loadTrack(index) {
            if (index < 0 || index >= tracks.length) return;
            
            currentTrackIndex = index;
            const track = tracks[index];
            
            audioPlayer.src = track.url;
            albumCover.src = track.cover;
            trackTitle.textContent = track.title;
            trackArtist.textContent = track.artist;
            timeTotal.textContent = track.durationStr;
            
            document.title = `${track.title} - ${track.artist}`;

            // Обновление активного трека в плейлисте
            const allTracks = playlistContainer.querySelectorAll('div[data-index]');
            allTracks.forEach(el => el.classList.remove('bg-cyan-500/20'));
            const activeTrackElement = playlistContainer.querySelector(`div[data-index='${index}']`);
            if(activeTrackElement) {
                activeTrackElement.classList.add('bg-cyan-500/20');
                activeTrackElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function playTrack() {
            audioPlayer.play();
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
        }

        function pauseTrack() {
            audioPlayer.pause();
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        playPauseBtn.addEventListener('click', () => {
            if (audioPlayer.paused) {
                playTrack();
            } else {
                pauseTrack();
            }
        });

        nextBtn.addEventListener('click', () => {
            let nextIndex = (currentTrackIndex + 1) % tracks.length;
            loadTrack(nextIndex);
            playTrack();
        });

        prevBtn.addEventListener('click', () => {
            let prevIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
            loadTrack(prevIndex);
            playTrack();
        });

        audioPlayer.addEventListener('timeupdate', () => {
            const { currentTime, duration } = audioPlayer;
            if (duration) {
                const progressPercent = (currentTime / duration) * 100;
                progressBar.style.width = `${progressPercent}%`;
                timeCurrent.textContent = formatTime(currentTime);
            }
        });

        audioPlayer.addEventListener('ended', () => {
            nextBtn.click();
        });
        
        progressBarContainer.addEventListener('click', (e) => {
            const width = progressBarContainer.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            if (duration) {
                audioPlayer.currentTime = (clickX / width) * duration;
            }
        });

        fetchTracks();
        
        // =============================================
        // СКРИПТ ДЛЯ УПРАВЛЕНИЯ МОДАЛЬНЫМ ОКНОМ
        // =============================================
        const openModalBtn = document.getElementById('openModalBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const qaModal = document.getElementById('qaModal');

        openModalBtn.addEventListener('click', () => qaModal.classList.remove('hidden'));
        closeModalBtn.addEventListener('click', () => qaModal.classList.add('hidden'));
        qaModal.addEventListener('click', (e) => {
            if (e.target === qaModal) qaModal.classList.add('hidden');
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !qaModal.classList.contains('hidden')) {
                qaModal.classList.add('hidden');
            }
        });

    </script>
</body>
</html>